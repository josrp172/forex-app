<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riri's Forex Bakery</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Quicksand:wght@500;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- The 3D World (Pastry Shop) -->
    <div id="canvas-container"></div>

    <!-- The UI Overlay -->
    <main class="ui-layer">
        <div class="glass-panel intro-card">
            <div class="profile-header">
                <div class="avatar-wrapper">
                    <!-- You might want to replace this with a cute drawing of yourself as a baker later! -->
                    <img src="{{ url_for('static', filename='avatar_true.jpg') }}" alt="My Profile" class="avatar-img">
                </div>
                <div class="text-content">
                    <h1 id="header-title"></h1>
                    <p id="header-desc"></p>
                </div>
            </div>

            <div class="action-area">
                <button class="primary-btn" id="start-btn">
                    Let's Bake!
                    <span class="arrow">â†’</span>
                </button>
            </div>
        </div>

        <!-- This speech bubble will be positioned by JS over the 3D character -->
        <div id="speech-bubble" class="speech-bubble">
            Hello! ğŸ‘‹
        </div>
    </main>

    <!-- The Curriculum / Journey Map Overlay -->
    <section class="curriculum-layer hidden" id="curriculum-layer">
        <div class="map-header">
            <h2>Your Recipe for Success ğŸ“œ</h2>
            <p>From fresh ingredients to a Masterpiece!</p>
        </div>

        <div class="journey-path">
            <!-- Level 1 -->
            <a href="{{ url_for('chapter1') }}" class="level-card unlocked">
                <div class="level-icon">ğŸ¥£</div>
                <div class="level-info">
                    <h3>Step 1: Kneading the Basics</h3>
                    <p>Ingredients of Forex: Pips, Lots & Leverage.</p>
                </div>
                <div class="status-badge">Start</div>
            </a>

            <!-- Connector Line -->
            <div class="path-line"></div>

            <!-- Level 2 -->
            <a href="{{ url_for('chapter2') }}" class="level-card unlocked">
                <div class="level-icon">ğŸ</div>
                <div class="level-info">
                    <h3>Step 2: Rising Trends</h3>
                    <p>Identifying the flow of the dough (Chart Patterns).</p>
                </div>
                <div class="status-badge">Unlocked</div>
            </a>

            <!-- Connector Line -->
            <div class="path-line"></div>

            <!-- Level 3 -->
            <!-- Level 3 -->
            <a href="{{ url_for('chapter3') }}" class="level-card" id="card-ch3">
                <div class="level-icon">ğŸ°</div>
                <div class="level-info">
                    <h3>Step 3: Secret Recipes</h3>
                    <p>Support, Resistance & Winning Strategies.</p>
                </div>
                <div class="status-badge">Locked</div>
            </a>

            <!-- Connector Line -->
            <div class="path-line"></div>

            <!-- Level 4 (Patterns) -->
            <a href="{{ url_for('chapter4') }}" class="level-card" id="card-ch4">
                <div class="level-icon">ğŸ“</div>
                <div class="level-info">
                    <h3>Step 4: The Blueprint</h3>
                    <p>Mastering Patterns & Terminology.</p>
                </div>
                <div class="status-badge">Locked</div>
            </a>

            <!-- Connector Line -->
            <div class="path-line"></div>

            <!-- Level 5 (Simulation) -->
            <a href="{{ url_for('chapter5') }}" class="level-card boss-level" id="card-ch5">
                <div class="level-icon">ğŸ‘¨â€ğŸ³</div>
                <div class="level-info">
                    <h3>Grand Opening: The Simulator</h3>
                    <p>Serve customers (Take Profits) in the real market!</p>
                </div>
                <div class="status-badge">Boss Level</div>
            </a>
        </div>

        <button class="back-btn" id="back-home-btn">â† Back Home</button>
    </section>

    <script type="module" src="{{ url_for('static', filename='main.js') }}"></script>
    <script>
        // Check Progression on Load
        window.addEventListener('load', () => {
            // Check if we came from Welcome Page
            if (sessionStorage.getItem('music_autoplay_authorized') === 'true') {
                // Try to consume the gesture authorization immediately if possible (though reloading page usually resets context)
                // This flag mainly hints SoundManager to be optimistic.
            }

            // localStorage key 'forex_progress' => 0 (start), 1 (ch1 done), 2 (ch2 done), 3 (ch3 done)
            let progress = parseInt(localStorage.getItem('forex_progress') || 0);

            // Map cards (Order: Ch1, Ch2, Ch3, Ch4, Ch5)
            const cards = document.querySelectorAll('.level-card');

            cards.forEach((card, index) => {
                const badge = card.querySelector('.status-badge');

                // Clear state
                card.classList.remove('locked', 'unlocked', 'completed');

                // Restore href if it was stored
                if (card.dataset.href) {
                    card.setAttribute('href', card.dataset.href);
                }

                if (index < progress) {
                    // Completed
                    card.classList.add('completed');
                    badge.innerText = "Done âœ“";
                } else if (index === progress) {
                    // Current Unlocked
                    card.classList.add('unlocked');
                    badge.innerText = index === 4 ? "Boss Level ğŸ”¥" : "Start Here";
                } else {
                    // Locked
                    card.classList.add('locked');
                    badge.innerText = "Locked ğŸ”’";
                    if (card.getAttribute('href')) {
                        card.dataset.href = card.getAttribute('href');
                        card.removeAttribute('href'); // Disable link
                    }
                }

                // Force visibility after small delay to fix any animation glitches
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 100 + (index * 100));
            });

            // Auto-open Map if requested via URL hash
            if (window.location.hash === '#map') {
                const mapLayer = document.getElementById('curriculum-layer');
                if (mapLayer) {
                    mapLayer.classList.remove('hidden');
                    // Reset scroll to top
                    mapLayer.scrollTop = 0;
                }
            }
        });
    </script>
    <script src="{{ url_for('static', filename='sound_manager.js') }}"></script>
</body>

</html>